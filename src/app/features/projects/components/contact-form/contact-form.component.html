<div class="max-w-2xl mx-auto p-8 bg-white rounded-lg shadow-lg border-2 border-amber-200">
  <h2 class="text-3xl font-serif font-bold mb-6 text-amber-900">Formulaire de Contact</h2>
  
  <form [formGroup]="contactForm" (ngSubmit)="onSubmit()" class="space-y-6">
    
    <!-- Nom -->
    <div>
      <label for="nom" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        Nom <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="nom"
        formControlName="nom"
        placeholder="Entrez votre nom"
        class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300"
        [class.border-red-500]="nom?.invalid && nom?.touched"
      />
      @if (nom?.hasError('required') && nom?.touched) {
        <p class="text-red-600 text-sm mt-1">Le nom est requis.</p>
      }
      @if (nom?.hasError('minlength') && nom?.touched) {
        <p class="text-red-600 text-sm mt-1">Le nom doit contenir au moins 2 caract√®res.</p>
      }
    </div>

    <!-- Pr√©nom -->
    <div>
      <label for="prenom" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        Pr√©nom <span class="text-red-500">*</span>
      </label>
      <input
        type="text"
        id="prenom"
        formControlName="prenom"
        placeholder="Entrez votre pr√©nom"
        class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300"
        [class.border-red-500]="prenom?.invalid && prenom?.touched"
      />
      @if (prenom?.hasError('required') && prenom?.touched) {
        <p class="text-red-600 text-sm mt-1">Le pr√©nom est requis.</p>
      }
      @if (prenom?.hasError('minlength') && prenom?.touched) {
        <p class="text-red-600 text-sm mt-1">Le pr√©nom doit contenir au moins 2 caract√®res.</p>
      }
    </div>

    <!-- Email -->
    <div>
      <label for="email" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        Email <span class="text-red-500">*</span>
      </label>
      <div class="relative">
        <input
          type="email"
          id="email"
          formControlName="email"
          placeholder="exemple@email.com"
          class="w-full px-4 py-2 pr-12 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300"
          [class.border-red-500]="email?.invalid && email?.touched && !email?.pending"
          [class.border-green-500]="email?.valid && email?.touched"
        />
        <!-- Indicateur de chargement pendant la validation asynchrone -->
        @if (email?.pending) {
          <div class="absolute right-3 top-1/2 -translate-y-1/2">
            <div class="animate-spin rounded-full h-5 w-5 border-2 border-amber-700 border-t-transparent"></div>
          </div>
        }
        @if (email?.valid && email?.touched && !email?.pending) {
          <div class="absolute right-3 top-1/2 -translate-y-1/2 text-green-500 text-xl">
            ‚úì
          </div>
        }
      </div>
      
      @if (email?.hasError('required') && email?.touched) {
        <p class="text-red-600 text-sm mt-1">L'email est requis.</p>
      }
      @if (email?.hasError('email') && email?.touched && !email?.pending) {
        <p class="text-red-600 text-sm mt-1">Veuillez entrer un email valide.</p>
      }
      @if (email?.hasError('emailExists') && email?.touched && !email?.pending) {
        <p class="text-red-600 text-sm mt-1">Cet email est d√©j√† utilis√©. Veuillez en choisir un autre.</p>
      }
      @if (email?.pending) {
        <p class="text-amber-700 text-sm mt-1 flex items-center gap-2">
          <span class="inline-block animate-pulse">üîç</span>
          V√©rification de la disponibilit√© de l'email...
        </p>
      }
      @if (email?.valid && email?.touched && !email?.pending) {
        <p class="text-green-600 text-sm mt-1">‚úÖ Email disponible !</p>
      }
    </div>

    <!-- T√©l√©phone -->
    <div>
      <label for="telephone" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        T√©l√©phone <span class="text-stone-400 text-xs">(optionnel)</span>
      </label>
      <input
        type="tel"
        id="telephone"
        formControlName="telephone"
        placeholder="0612345678"
        class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300"
        [class.border-red-500]="telephone?.invalid && telephone?.touched"
      />
      @if (telephone?.hasError('pattern') && telephone?.touched) {
        <p class="text-red-600 text-sm mt-1">Format invalide. Utilisez un num√©ro fran√ßais (ex: 0612345678).</p>
      }
      <p class="text-stone-500 text-xs mt-1">Format: 0X XX XX XX XX (10 chiffres commen√ßant par 0)</p>
    </div>

    <!-- Mot de passe -->
    <div>
      <label for="password" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        Mot de passe <span class="text-red-500">*</span>
      </label>
      <div class="relative">
        <input
          [type]="showPassword ? 'text' : 'password'"
          id="password"
          formControlName="password"
          placeholder="Entrez un mot de passe fort"
          class="w-full px-4 py-2 pr-12 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300"
          [class.border-red-500]="password?.invalid && password?.touched"
          [class.border-green-500]="password?.valid && password?.touched"
        />
        <button
          type="button"
          (click)="togglePasswordVisibility()"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-stone-500 hover:text-stone-700 transition duration-300"
        >
          @if (showPassword) {
            üëÅÔ∏è
          } @else {
            üëÅÔ∏è‚Äçüó®Ô∏è
          }
        </button>
      </div>
      
      @if (password?.hasError('required') && password?.touched) {
        <p class="text-red-600 text-sm mt-1">Le mot de passe est requis.</p>
      }
      
      @if (password?.hasError('passwordStrength') && password?.touched) {
        <div class="mt-2 p-3 bg-red-50 rounded-lg border border-red-200">
          <p class="text-red-700 text-sm font-sans font-semibold mb-2">Le mot de passe doit contenir :</p>
          <ul class="space-y-1 text-xs">
            <li [class.text-green-600]="password?.errors?.['passwordStrength']?.hasUpperCase" 
                [class.text-red-600]="!password?.errors?.['passwordStrength']?.hasUpperCase">
              @if (password?.errors?.['passwordStrength']?.hasUpperCase) { ‚úÖ } @else { ‚ùå }
              Au moins une majuscule (A-Z)
            </li>
            <li [class.text-green-600]="password?.errors?.['passwordStrength']?.hasLowerCase" 
                [class.text-red-600]="!password?.errors?.['passwordStrength']?.hasLowerCase">
              @if (password?.errors?.['passwordStrength']?.hasLowerCase) { ‚úÖ } @else { ‚ùå }
              Au moins une minuscule (a-z)
            </li>
            <li [class.text-green-600]="password?.errors?.['passwordStrength']?.hasNumeric" 
                [class.text-red-600]="!password?.errors?.['passwordStrength']?.hasNumeric">
              @if (password?.errors?.['passwordStrength']?.hasNumeric) { ‚úÖ } @else { ‚ùå }
              Au moins un chiffre (0-9)
            </li>
            <li [class.text-green-600]="password?.errors?.['passwordStrength']?.hasSpecialChar" 
                [class.text-red-600]="!password?.errors?.['passwordStrength']?.hasSpecialChar">
              @if (password?.errors?.['passwordStrength']?.hasSpecialChar) { ‚úÖ } @else { ‚ùå }
              Au moins un caract√®re sp√©cial (&#33;&#64;&#35;&#36;&#37;&#94;&#38;&#42;...)
            </li>
            <li [class.text-green-600]="password?.errors?.['passwordStrength']?.hasMinLength" 
                [class.text-red-600]="!password?.errors?.['passwordStrength']?.hasMinLength">
              @if (password?.errors?.['passwordStrength']?.hasMinLength) { ‚úÖ } @else { ‚ùå }
              Minimum 8 caract√®res
            </li>
          </ul>
        </div>
      }
      
      @if (password?.valid && password?.touched) {
        <p class="text-green-600 text-sm mt-1">‚úÖ Mot de passe fort !</p>
      }
    </div>

    <!-- Confirmation du mot de passe -->
    <div>
      <label for="confirmPassword" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        Confirmer le mot de passe <span class="text-red-500">*</span>
      </label>
      <div class="relative">
        <input
          [type]="showConfirmPassword ? 'text' : 'password'"
          id="confirmPassword"
          formControlName="confirmPassword"
          placeholder="Confirmez votre mot de passe"
          class="w-full px-4 py-2 pr-12 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300"
          [class.border-red-500]="confirmPassword?.invalid && confirmPassword?.touched"
          [class.border-green-500]="confirmPassword?.valid && confirmPassword?.touched"
        />
        <button
          type="button"
          (click)="toggleConfirmPasswordVisibility()"
          class="absolute right-3 top-1/2 -translate-y-1/2 text-stone-500 hover:text-stone-700 transition duration-300"
        >
          @if (showConfirmPassword) {
            üëÅÔ∏è
          } @else {
            üëÅÔ∏è‚Äçüó®Ô∏è
          }
        </button>
      </div>
      
      @if (confirmPassword?.hasError('required') && confirmPassword?.touched) {
        <p class="text-red-600 text-sm mt-1">La confirmation du mot de passe est requise.</p>
      }
      
      @if (confirmPassword?.hasError('passwordMismatch') && confirmPassword?.touched) {
        <p class="text-red-600 text-sm mt-1">Les mots de passe ne correspondent pas.</p>
      }
      
      @if (confirmPassword?.valid && confirmPassword?.touched && !confirmPassword?.hasError('passwordMismatch')) {
        <p class="text-green-600 text-sm mt-1">‚úÖ Les mots de passe correspondent !</p>
      }
    </div>

    <!-- Message -->
    <div>
      <label for="message" class="block text-sm font-sans font-medium text-stone-700 mb-2">
        Message <span class="text-red-500">*</span>
      </label>
      <textarea
        id="message"
        formControlName="message"
        rows="5"
        placeholder="Entrez votre message (minimum 10 caract√®res)"
        class="w-full px-4 py-2 border border-amber-300 rounded-lg focus:ring-2 focus:ring-amber-200 focus:border-amber-600 transition duration-300 resize-none"
        [class.border-red-500]="message?.invalid && message?.touched"
      ></textarea>
      @if (message?.hasError('required') && message?.touched) {
        <p class="text-red-600 text-sm mt-1">Le message est requis.</p>
      }
      @if (message?.hasError('minlength') && message?.touched) {
        <p class="text-red-600 text-sm mt-1">Le message doit contenir au moins 10 caract√®res ({{ message?.value?.length || 0 }}/10).</p>
      }
      @if (message?.valid || !message?.touched) {
        <p class="text-stone-500 text-xs mt-1">{{ message?.value?.length || 0 }} caract√®res</p>
      }
    </div>

    <!-- Boutons -->
    <div class="flex gap-4 pt-4">
      <button
        type="submit"
        [disabled]="contactForm.invalid"
        class="flex-1 px-6 py-3 bg-amber-700 text-white rounded-lg font-sans font-medium hover:bg-amber-800 disabled:bg-stone-400 disabled:cursor-not-allowed transition duration-300 shadow-md hover:shadow-lg"
      >
        Envoyer
      </button>
      <button
        type="button"
        (click)="contactForm.reset()"
        class="px-6 py-3 bg-amber-100 text-stone-700 rounded-lg font-sans font-medium hover:bg-amber-200 transition duration-300"
      >
        R√©initialiser
      </button>
    </div>

    <!-- Statut du formulaire -->
    <div class="mt-4 p-4 bg-amber-50 rounded-lg border border-amber-200">
      <p class="text-sm font-sans font-medium text-stone-700">
        Statut: 
        @if (contactForm.pending) {
          <span class="text-amber-700 font-bold">Validation en cours...</span>
        } @else if (contactForm.valid) {
          <span class="text-green-600 font-bold">Valide</span>
        } @else {
          <span class="text-orange-600 font-bold">Incomplet</span>
        }
      </p>
    </div>
  </form>
</div>
